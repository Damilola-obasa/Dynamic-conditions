steps:
  - label: "Validation check"
    command: ./scripts/validation_tests.sh
    soft:
    key: "validation-check"
  - label: "Run regression only if validation check is passed"
    command: |
      if [ $$(buildkite-agent step get "outcome" --step "validation-check") != "passed" ]; then
         cat <<- YAML | buildkite-agent pipeline upload
         steps:
           - label: "Run Regression"
             command: ./scripts/regression_tests.sh
           - block: ":rocket: failed?"


      YAML
      fi
